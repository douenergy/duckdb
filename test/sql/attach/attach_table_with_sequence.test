# name: test/sql/attach/attach_table_with_sequence.test
# description: Test attaching a duckdb file that contains a table relying on a sequence. (issue 10263)
# group: [attach]

require noforcestorage

# create a table with a sequence in seq.db
statement ok
ATTACH '__TEST_DIR__/seq.db' AS seq;

statement ok
USE seq;

statement ok
CREATE SEQUENCE 'id_seq';

statement ok
CREATE TABLE person (id INT DEFAULT nextval('id_seq'), age INT NOT NULL);

statement ok
INSERT INTO person (age) VALUES (10);

query II
SELECT * FROM seq.person;
----
1	10

# use memory catalog as default
statement ok
ATTACH ':memory:' AS mem;

statement ok
USE mem;

# Detach the table-with-seq.db
statement ok
DETACH seq;

# we cant read the table anymore
statement error
FROM person;
----

statement ok
ATTACH '__TEST_DIR__/seq.db' AS seq;

statement ok
use seq;

