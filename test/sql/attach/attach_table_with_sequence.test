# name: test/sql/attach/attach_table_with_sequence.test
# description: Test attaching a duckdb file that contains a table relying on a sequence. (issue 10263)
# group: [attach]

require noforcestorage

# create a table with a sequence in seq.db
statement ok
ATTACH '__TEST_DIR__/seq.db' AS seq;

statement ok
USE seq;

statement ok
CREATE SEQUENCE 'id_seq';

statement ok
CREATE TABLE person (id INT DEFAULT nextval('id_seq'), age INT NOT NULL);

statement ok
INSERT INTO person (age) VALUES (10);

query II
SELECT * FROM seq.person;
----
1	10

# use memory catalog as default
statement ok
ATTACH ':memory:' AS mem;

statement ok
USE mem;

# detach the seq.db
statement ok
DETACH seq;

# we can't read the table anymore
statement error
FROM person;
----

statement ok
ATTACH '__TEST_DIR__/seq.db' AS seq;

statement ok
use seq;

statement ok
INSERT INTO person (age) VALUES (20) , (30);

query II
SELECT * FROM person;
----
1	10
2	20
3	30

# Use the memory catalog
statement ok
USE mem;

# read the person table again
query II
SELECT * FROM seq.person;
----
1	10
2	20
3	30
